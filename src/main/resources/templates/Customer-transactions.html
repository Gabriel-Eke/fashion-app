<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Customer Transactions - FashionApp</title>
    <link rel="stylesheet" href="/style.css">
</head>
<body>

<header>
    <h1>Customer Transactions</h1>

    <nav>
        <a href="/" class="btn">Home</a>
        <a href="/customer-transactions" class="btn btn-secondary">Transactions</a>
        <a href="/daily-operations" class="btn">Daily Operations</a>
        <a href="/inventory" class="btn">Inventory</a>
        <a href="/logout" class="btn">Logout</a>
    </nav>
</header>

<div class="transactions-wrapper">

    <!-- ADD NEW TRANSACTION -->
    <h2 class="transactions-title">Add New Customer Transaction</h2>

    <form method="post" action="/customer-transactions" class="transaction-form">

        <input type="text" name="name" placeholder="Customer Name" required>
        <input type="text" name="phoneNumber" placeholder="Phone Number" required>
        <input type="email" name="email" placeholder="Email" required>

        <input type="text" name="typeOfCloth" placeholder="Type of Cloth" list="cloth-types" required>
        <datalist id="cloth-types">
            <option value="Shirt">
            <option value="Dress">
            <option value="Trouser">
            <option value="Jacket">
            <option value="Skirt">
            <option value="Agbada">
            <option value="Blouse">
            <option value="Kaftan">
            <option value="Native Wear">
        </datalist>

        <!-- COLOR -->
        <select name="color" required>
            <option value="">Select Color</option>
            <option value="White">White</option>
            <option value="Black">Black</option>
            <option value="Blue">Blue</option>
            <option value="Green">Green</option>
            <option value="Red">Red</option>
            <option value="Pink">Pink</option>
            <option value="Purple">Purple</option>
        </select>

        <input type="text" name="material" placeholder="Material" list="material-types" required>
        <datalist id="material-types">
            <option value="Cotton">
            <option value="Wool">
            <option value="Cashmere">
            <option value="Silk">
            <option value="Leather">
            <option value="Chiffon">
            <option value="Velvet">
            <option value="Kente">
            <option value="Aso Oke">
            <option value="Adire">
            <option value="Ankara">
            <option value="Kitenge">
            <option value="Silk Brocade">
            <option value="Khadi">
            <option value="Batiks">
        </datalist>
        <input type="number" name="quantity" placeholder="Quantity" required>

        <input type="number" id="purchasePrice" name="purchasePrice" placeholder="Purchase Price" required>
        <input type="number" id="depositeAmount" name="depositeAmount" placeholder="Deposit Amount" required>
        <input type="number" id="remainingAmount" name="remainingAmount" placeholder="Remaining Amount" readonly required>

        <input type="datetime-local" name="pickupDateTime" required>

        <!-- STATUS -->
        <select name="status" required>
            <option value="">Select Status</option>
            <option value="Pending">Pending</option>
            <option value="In Progress">In Progress</option>
            <option value="Completed">Completed</option>
            <option value="Collected">Collected</option>
        </select>

        <input type="text" name="note" placeholder="Note" required>  <!---new add-->

        <button class="btn" type="submit">Save Transaction</button>
    </form>

    <!-- SEARCH -->
    <h2 class="transactions-title">Search Transactions</h2>
    <input type="text" id="searchBox" placeholder="Search by name, cloth type, color..." class="search-input">

    <!-- TABLE -->
    <table class="transaction-table">
        <thead>
            <tr>
                <th>Date</th>
                <th>Name</th>
                <th>Cloth</th>
                <th>Price</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
        </thead>

        <tbody id="transactionTableBody">
            <tr th:each="t : ${transactions}">
                <td th:text="${#temporals.format(t.addDateTime, 'yyyy-MM-dd')}"></td>
                <td th:text="${t.name}"></td>
                <td th:text="${t.typeOfCloth}"></td>
                <td>$<span th:text="${t.purchasePrice}"></span></td>
                <td th:text="${t.status}"></td>

                <td>
                    <!-- View Customer -->
                    <a th:href="@{/customer-transactions/customer/{id}(id=${t.id})}"
                       class="table-btn btn btn-secondary">View</a>

                    <!-- Edit -->
                    <a th:href="@{/customer-transactions/edit/{id}(id=${t.id})}"
                       class="table-btn edit-btn">Edit</a>

                    <!-- Delete -->
                    <a th:href="@{/customer-transactions/delete/{id}(id=${t.id})}"
                       class="table-btn delete-btn"
                       onclick="return confirm('Are you sure you want to delete this transaction?');">
                        Delete
                    </a>
                </td>
            </tr>
        </tbody>
    </table>

</div>

<!-- JS -->
<script>
    const amountInput = document.getElementById("purchasePrice");
    const depositInput = document.getElementById("depositeAmount");
    const remainingInput = document.getElementById("remainingAmount");

    function updateRemaining() {
        let amount = parseFloat(amountInput.value) || 0;
        let deposit = parseFloat(depositInput.value) || 0;
        remainingInput.value = (amount - deposit).toFixed(2);
    }

    amountInput.addEventListener("input", updateRemaining);
    depositInput.addEventListener("input", updateRemaining);

    // Search Filter
    document.getElementById("searchBox").addEventListener("input", function () {
        let filter = this.value.toLowerCase();
        let rows = document.querySelectorAll("#transactionTableBody tr");

        rows.forEach(row => {
            let text = row.innerText.toLowerCase();
            row.style.display = text.includes(filter) ? "" : "none";
        });
    });
</script>

</body>
</html>



